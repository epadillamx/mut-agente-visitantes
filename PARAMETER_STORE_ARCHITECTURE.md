# Arquitectura de Parameter Store - Desacoplamiento Completo

## üìã Resumen

Esta arquitectura elimina la dependencia directa entre los stacks de Bedrock y ChatLambda, usando **AWS Systems Manager Parameter Store** como capa de configuraci√≥n centralizada.

## üèóÔ∏è Nueva Arquitectura (Desacoplada)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ GenAiVirtualAssistantBedrockStack                       ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  ‚úì Bedrock Agent                                        ‚îÇ
‚îÇ  ‚úì Agent Alias                                          ‚îÇ
‚îÇ  ‚úì Knowledge Base                                       ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  ‚úì SSM Parameters (5 total):                            ‚îÇ
‚îÇ    1. /whatsapp/bedrock-agent/agent-id                  ‚îÇ
‚îÇ    2. /whatsapp/bedrock-agent/agent-alias-id            ‚îÇ
‚îÇ    3. /whatsapp/bedrock-agent/token                     ‚îÇ
‚îÇ    4. /whatsapp/bedrock-agent/phone-id                  ‚îÇ
‚îÇ    5. /whatsapp/bedrock-agent/verify-token              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚ñ≤
                   ‚îÇ Lee par√°metros en runtime
                   ‚îÇ (NO hay dependencia de stack)
                   ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ChatLambdaNodeStack                                      ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  ‚úì Lambda Function (Node.js 22)                         ‚îÇ
‚îÇ  ‚úì API Gateway (REST)                                   ‚îÇ
‚îÇ  ‚úì WhatsApp Webhook Endpoints                           ‚îÇ
‚îÇ  ‚úì SSM Read Permissions (5 par√°metros)                  ‚îÇ
‚îÇ  ‚úì Bedrock Permissions                                   ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  Variables de entorno:                                   ‚îÇ
‚îÇ    - PARAM_AGENT_ID                                      ‚îÇ
‚îÇ    - PARAM_AGENT_ALIAS_ID                                ‚îÇ
‚îÇ    - PARAM_TOKEN_WHATS                                   ‚îÇ
‚îÇ    - PARAM_IPHONE_ID                                     ‚îÇ
‚îÇ    - PARAM_VERIFY_TOKEN                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîë Par√°metros en Parameter Store

### 1. Par√°metros de Bedrock (Auto-creados)

| Par√°metro | Path | Tipo | Descripci√≥n | Valor |
|-----------|------|------|-------------|-------|
| **Agent ID** | `/whatsapp/bedrock-agent/agent-id` | String | ID del Bedrock Agent | Auto (desde CDK) |
| **Alias ID** | `/whatsapp/bedrock-agent/agent-alias-id` | String | ID del Agent Alias | Auto (desde CDK) |

### 2. Par√°metros de WhatsApp (Requieren actualizaci√≥n)

| Par√°metro | Path | Tipo | Descripci√≥n | Valor Inicial |
|-----------|------|------|-------------|---------------|
| **Token** | `/whatsapp/bedrock-agent/token` | String | WhatsApp API Token | PLACEHOLDER |
| **Phone ID** | `/whatsapp/bedrock-agent/phone-id` | String | WhatsApp Phone Number ID | PLACEHOLDER |
| **Verify Token** | `/whatsapp/bedrock-agent/verify-token` | String | Webhook Verify Token | mi_token_secreto_123 |

## üì¶ Cambios Implementados

### 1. Stack de Bedrock (`stack_backend_bedrock.py`)

#### M√©todo `_create_whatsapp_parameters()` Actualizado

```python
def _create_whatsapp_parameters(self):
    """
    Crea 5 par√°metros en Parameter Store:
    - 2 para Bedrock (agent-id, agent-alias-id) - valores autom√°ticos
    - 3 para WhatsApp (token, phone-id, verify-token) - requieren actualizaci√≥n
    """
    
    # 1. Agent ID (valor autom√°tico desde self.agent_id)
    agent_id_param = ssm.StringParameter(
        self, "BedrockAgentIdParameter",
        parameter_name="/whatsapp/bedrock-agent/agent-id",
        string_value=self.agent_id,
        description="Bedrock Agent ID",
        type=ssm.ParameterType.STRING
    )
    
    # 2. Agent Alias ID (valor autom√°tico desde self.agent_alias_id)
    agent_alias_id_param = ssm.StringParameter(
        self, "BedrockAgentAliasIdParameter",
        parameter_name="/whatsapp/bedrock-agent/agent-alias-id",
        string_value=self.agent_alias_id,
        description="Bedrock Agent Alias ID",
        type=ssm.ParameterType.STRING
    )
    
    # 3-5. WhatsApp credentials (requieren actualizaci√≥n manual)
    # ... (token, phone-id, verify-token)
```

**Outputs CloudFormation:**
- `output-param-agent-id`
- `output-param-agent-alias-id`
- `output-param-token`
- `output-param-phone-id`
- `output-param-verify-token`

### 2. Stack de ChatLambda (`stack_chat_lambda.py`)

#### Constructor Simplificado

```python
def __init__(self, scope: Construct, construct_id: str, **kwargs) -> None:
    # YA NO recibe agent_id ni agent_alias_id como par√°metros
    
    # Paths de Parameter Store
    PARAM_AGENT_ID = "/whatsapp/bedrock-agent/agent-id"
    PARAM_AGENT_ALIAS_ID = "/whatsapp/bedrock-agent/agent-alias-id"
    PARAM_TOKEN_WHATS = "/whatsapp/bedrock-agent/token"
    PARAM_IPHONE_ID = "/whatsapp/bedrock-agent/phone-id"
    PARAM_VERIFY_TOKEN = "/whatsapp/bedrock-agent/verify-token"
    
    # Variables de entorno: solo paths, NO valores
    environment={
        "PARAM_AGENT_ID": PARAM_AGENT_ID,
        "PARAM_AGENT_ALIAS_ID": PARAM_AGENT_ALIAS_ID,
        "PARAM_TOKEN_WHATS": PARAM_TOKEN_WHATS,
        "PARAM_IPHONE_ID": PARAM_IPHONE_ID,
        "PARAM_VERIFY_TOKEN": PARAM_VERIFY_TOKEN
    }
```

#### Permisos SSM Actualizados

```python
def _configure_ssm_permissions(self, param_agent_id: str, param_agent_alias_id: str,
                               param_token: str, param_phone: str, param_verify: str):
    # Permisos para leer los 5 par√°metros
    self.lambda_fn.add_to_role_policy(
        iam.PolicyStatement(
            actions=["ssm:GetParameter", "ssm:GetParameters"],
            resources=[
                f"arn:aws:ssm:{region}:{account}:parameter{param_agent_id}",
                f"arn:aws:ssm:{region}:{account}:parameter{param_agent_alias_id}",
                # ... otros 3 par√°metros
            ]
        )
    )
```

### 3. C√≥digo Lambda (`getAgente.js`)

#### Lectura Din√°mica de Agent IDs

```javascript
const { getParameter } = require('./ssmHelper');

async function getAgente(userId, question, messageId) {
    // Obtener Agent IDs desde Parameter Store en runtime
    const PARAM_AGENT_ID = process.env.PARAM_AGENT_ID || '/whatsapp/bedrock-agent/agent-id';
    const PARAM_AGENT_ALIAS_ID = process.env.PARAM_AGENT_ALIAS_ID || '/whatsapp/bedrock-agent/agent-alias-id';
    
    const AGENT_ID = await getParameter(PARAM_AGENT_ID, false);  // No encryption
    const AGENT_ALIAS_ID = await getParameter(PARAM_AGENT_ALIAS_ID, false);
    
    console.log(`ü§ñ Agent ID: ${AGENT_ID}, Alias: ${AGENT_ALIAS_ID}`);
    
    // Usar AGENT_ID y AGENT_ALIAS_ID din√°micos
    const command = new InvokeAgentCommand({
        agentId: AGENT_ID,
        agentAliasId: AGENT_ALIAS_ID,
        sessionId: `whatsapp-${userId}`,
        inputText: question
    });
    // ...
}
```

### 4. Archivo Principal (`app.py`)

#### SIN Dependencia entre Stacks

```python
# Bedrock Stack (independiente)
bedrock_stack = GenAiVirtualAssistantBedrockStack(...)

# Chat Stack (independiente, lee par√°metros en runtime)
chat_stack = ChatLambdaNodeStack(app, "ChatLambdaNodeStack", env=env_aws_settings)

# NO hay chat_stack.add_dependency(bedrock_stack)
```

## üöÄ Proceso de Despliegue

### Orden Recomendado (aunque no es obligatorio)

```bash
# 1. Desplegar Bedrock stack primero (crea los par√°metros)
cdk deploy GenAiVirtualAssistantBedrockStack --require-approval never

# 2. Actualizar valores en Parameter Store (WhatsApp credentials)
aws ssm put-parameter \
  --name "/whatsapp/bedrock-agent/token" \
  --value "EAAXdHr..." \
  --type "String" \
  --overwrite

aws ssm put-parameter \
  --name "/whatsapp/bedrock-agent/phone-id" \
  --value "123456789" \
  --type "String" \
  --overwrite

# 3. Desplegar Chat Lambda stack
cdk deploy ChatLambdaNodeStack --require-approval never

# Alternativamente, desplegar todo de una vez:
cdk deploy --all --require-approval never
```

### Verificar Par√°metros Creados

```bash
# Listar todos los par√°metros de WhatsApp
aws ssm describe-parameters \
  --filters "Key=Name,Values=/whatsapp/bedrock-agent/"

# Ver valor de un par√°metro espec√≠fico
aws ssm get-parameter \
  --name "/whatsapp/bedrock-agent/agent-id"

aws ssm get-parameter \
  --name "/whatsapp/bedrock-agent/agent-alias-id"
```

## ‚úÖ Ventajas de esta Arquitectura

### 1. **Desacoplamiento Total**
- ‚úÖ No hay dependencia directa entre stacks
- ‚úÖ Cada stack puede desplegarse independientemente
- ‚úÖ Rollbacks m√°s simples y seguros

### 2. **Configuraci√≥n Centralizada**
- ‚úÖ Todos los par√°metros en un solo lugar (Parameter Store)
- ‚úÖ Actualizaci√≥n de credenciales sin redespliegue
- ‚úÖ Auditor√≠a centralizada de cambios

### 3. **Flexibilidad**
- ‚úÖ Cambiar Agent ID sin modificar c√≥digo
- ‚úÖ Rotar tokens sin tocar infraestructura
- ‚úÖ M√∫ltiples lambdas pueden usar los mismos par√°metros

### 4. **Seguridad**
- ‚úÖ Permisos IAM granulares por par√°metro
- ‚úÖ Valores sensibles en Parameter Store (no en c√≥digo)
- ‚úÖ Cach√© de 5 minutos reduce llamadas SSM

### 5. **Costo Optimizado**
- ‚úÖ Parameter Store tier STANDARD: **GRATIS** hasta 10,000 par√°metros
- ‚úÖ Cach√© reduce llamadas API a SSM
- ‚úÖ No hay recursos adicionales (DynamoDB, Secrets Manager)

## üîÑ Actualizaci√≥n de Configuraci√≥n

### Cambiar Agent ID (sin redespliegue)

```bash
# 1. Obtener nuevo Agent ID del stack de Bedrock
NEW_AGENT_ID=$(aws cloudformation describe-stacks \
  --stack-name GenAiVirtualAssistantBedrockStack \
  --query 'Stacks[0].Outputs[?OutputKey==`output-agent-id`].OutputValue' \
  --output text)

# 2. Actualizar par√°metro (el Lambda lo detectar√° autom√°ticamente)
aws ssm put-parameter \
  --name "/whatsapp/bedrock-agent/agent-id" \
  --value "$NEW_AGENT_ID" \
  --type "String" \
  --overwrite

# 3. Esperar hasta 5 minutos (cach√©) o forzar con:
# - Reiniciar Lambda
# - Invocar con nueva sesi√≥n
```

### Rotar WhatsApp Token

```bash
aws ssm put-parameter \
  --name "/whatsapp/bedrock-agent/token" \
  --value "NUEVO_TOKEN_WHATSAPP" \
  --type "String" \
  --overwrite

# El Lambda usar√° el nuevo token en la siguiente invocaci√≥n (m√°x 5 min)
```

## üêõ Troubleshooting

### Error: "Parameter /whatsapp/bedrock-agent/agent-id not found"

**Causa:** El stack de Bedrock no ha sido desplegado.

**Soluci√≥n:**
```bash
cdk deploy GenAiVirtualAssistantBedrockStack --require-approval never
```

### Error: "AccessDeniedException: User is not authorized to perform ssm:GetParameter"

**Causa:** Permisos IAM incorrectos.

**Soluci√≥n:** Verificar que `_configure_ssm_permissions()` incluye los 5 par√°metros:
```bash
aws iam get-role-policy \
  --role-name ChatLambdaNodeStack-chatlambdafn... \
  --policy-name SSMParameterPolicy
```

### Lambda obtiene valores "PLACEHOLDER"

**Causa:** No se han actualizado los par√°metros de WhatsApp.

**Soluci√≥n:**
```bash
# Actualizar con valores reales
aws ssm put-parameter --name "/whatsapp/bedrock-agent/token" --value "REAL_TOKEN" --overwrite
aws ssm put-parameter --name "/whatsapp/bedrock-agent/phone-id" --value "REAL_PHONE_ID" --overwrite
```

### Cach√© devuelve valores antiguos

**Causa:** Cach√© de 5 minutos en `ssmHelper.js`.

**Soluci√≥n:**
- Esperar 5 minutos
- Reiniciar Lambda: `aws lambda update-function-code ...`
- Limpiar cach√© manualmente (requiere modificar c√≥digo)

## üìä Diagrama de Flujo de Datos

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   WhatsApp   ‚îÇ
‚îÇ   Message    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   API Gateway                        ‚îÇ
‚îÇ   POST /webhook                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Lambda: index.handler              ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ   ‚îÇ getAgente(userId, question)  ‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ               ‚îÇ                      ‚îÇ
‚îÇ               ‚ñº                      ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ   ‚îÇ ssmHelper.getParameter()     ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ - agent-id                   ‚îÇ‚óÑ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ Parameter Store
‚îÇ   ‚îÇ - agent-alias-id             ‚îÇ   ‚îÇ    /whatsapp/bedrock-agent/*
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ               ‚îÇ                      ‚îÇ
‚îÇ               ‚ñº                      ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ   ‚îÇ InvokeAgentCommand           ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ agentId: <from SSM>          ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ aliasId: <from SSM>          ‚îÇ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚ñ∫ Bedrock Agent
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   WhatsApp   ‚îÇ
‚îÇ   Response   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìù Checklist de Despliegue

- [ ] Desplegar Bedrock Stack
- [ ] Verificar par√°metros creados en Parameter Store
- [ ] Actualizar token de WhatsApp
- [ ] Actualizar phone-id de WhatsApp
- [ ] (Opcional) Actualizar verify-token
- [ ] Desplegar Chat Lambda Stack
- [ ] Verificar permisos IAM del Lambda
- [ ] Probar endpoint `/chat` con curl
- [ ] Configurar webhook en Meta Developer Console
- [ ] Probar verificaci√≥n de webhook
- [ ] Enviar mensaje de prueba desde WhatsApp
- [ ] Verificar logs en CloudWatch

## üìö Referencias

- [AWS Systems Manager Parameter Store](https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html)
- [AWS CDK ssm Module](https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ssm.html)
- [Parameter Store Pricing](https://aws.amazon.com/systems-manager/pricing/) - Standard tier GRATIS
- [IAM Best Practices for Parameter Store](https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-paramstore-access.html)

---

**√öltima actualizaci√≥n:** Octubre 2025  
**Versi√≥n:** 2.0 (Desacoplamiento completo)  
**Stack CDK:** Python 3.x  
**Runtime Lambda:** Node.js 22.x
